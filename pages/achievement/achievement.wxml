<!--æˆå°±å±•å…é¡µé¢-->
<navigation-bar title="æˆå°±å±•å…" background="linear-gradient(135deg, #C6F8B2 0%, #76C893 50%, #4A7C59 100%)" color="#ffffff" back="{{true}}" homeButton="{{true}}"></navigation-bar>

<view class="container">

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <scroll-view class="main-content" scroll-y="true">
    <!-- æˆå°±æ¦‚è§ˆ -->
    <view class="overview-section">
      <view class="overview-card">
        <view class="overview-item">
          <text class="overview-number">{{totalAchievements}}</text>
          <text class="overview-label">æ€»æˆå°±æ•°</text>
        </view>
        <view class="overview-item">
          <text class="overview-number">{{unlockedCount}}</text>
          <text class="overview-label">å·²è§£é”</text>
        </view>
        <view class="overview-item">
          <text class="overview-number">{{achievementPoints}}</text>
          <text class="overview-label">æˆå°±ç‚¹æ•°</text>
        </view>
      </view>
    </view>

    <!-- æœ€æ–°æˆå°± -->
    <view class="latest-section" wx:if="{{latestAchievement}}">
      <view class="section-title">
        <text class="title-icon">ğŸ‰</text>
        <text class="title-text">æœ€æ–°è§£é”</text>
      </view>
      <view class="latest-card">
        <view class="achievement-badge">
          <text class="badge-icon">{{latestAchievement.icon}}</text>
        </view>
        <view class="achievement-info">
          <text class="achievement-name">{{latestAchievement.name}}</text>
          <text class="achievement-description">{{latestAchievement.description}}</text>
          <text class="achievement-date">{{latestAchievement.unlockedDate}}</text>
        </view>
      </view>
    </view>

    <!-- æˆå°±åˆ†ç±» -->
    <view class="category-section">
      <view class="section-title">
        <text class="title-icon">ğŸ†</text>
        <text class="title-text">æˆå°±åˆ†ç±»</text>
      </view>
      <view class="category-tabs">
        <view class="tab-item {{activeCategory === item.id ? 'active' : ''}}" 
              wx:for="{{categories}}" 
              wx:key="id" 
              bindtap="switchCategory" 
              data-category="{{item.id}}">
          <text class="tab-icon">{{item.icon}}</text>
          <text class="tab-text">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- æˆå°±åˆ—è¡¨ -->
    <view class="achievements-section">
      <view class="achievement-item {{item.unlocked ? 'unlocked' : 'locked'}}" 
            wx:for="{{filteredAchievements}}" 
            wx:key="id"
            bindtap="showAchievementDetail"
            data-id="{{item.id}}">
        <view class="achievement-badge">
          <text class="badge-icon">{{item.icon}}</text>
          <view wx:if="{{!item.unlocked}}" class="lock-overlay">
            <text class="lock-icon">ğŸ”’</text>
          </view>
        </view>
        <view class="achievement-content">
          <view class="achievement-header">
            <text class="achievement-name">{{item.name}}</text>
            <view class="achievement-rarity {{item.rarity}}">
              <text class="rarity-text">{{item.rarityText}}</text>
            </view>
          </view>
          <text class="achievement-description">{{item.description}}</text>
          <view class="achievement-progress" wx:if="{{item.progress}}">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.progress.percentage}}%"></view>
            </view>
            <text class="progress-text">{{item.progress.current}}/{{item.progress.total}}</text>
          </view>
          <view class="achievement-footer">
            <text class="achievement-points">+{{item.points}} ç‚¹æ•°</text>
            <text wx:if="{{item.unlocked}}" class="achievement-date">{{item.unlockedDate}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredAchievements.length === 0}}">
      <text class="empty-icon">ğŸ¯</text>
      <text class="empty-text">è¯¥åˆ†ç±»ä¸‹æš‚æ— æˆå°±</text>
      <text class="empty-hint">ç»§ç»­åŠªåŠ›ï¼Œè§£é”æ›´å¤šæˆå°±å§ï¼</text>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="action-button primary" open-type="share">
        <text class="button-icon">ğŸ“¤</text>
        <text class="button-text">åˆ†äº«æˆå°±</text>
      </button>
      <button class="action-button secondary" bindtap="resetAchievements">
        <text class="button-icon">ğŸ”„</text>
        <text class="button-text">é‡ç½®æˆå°±</text>
      </button>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨å¯¼èˆªæ  -->
  <view class="bottom-nav {{navFixed ? 'fixed' : ''}}" bindtouchstart="onTouchStart">
    <view class="nav-item {{currentPage === 'theory' ? 'active' : ''}}" bindtap="navigateToTheory">
      <view class="nav-icon">ğŸ“</view>
      <view class="nav-label">ç†è®ºè®°å½•</view>
    </view>
    <view class="nav-item {{currentPage === 'action' ? 'active' : ''}}" bindtap="navigateToAction">
      <view class="nav-icon">ğŸ¯</view>
      <view class="nav-label">è¡ŒåŠ¨ç”Ÿæˆ</view>
    </view>
    <view class="nav-item {{currentPage === 'execution' ? 'active' : ''}}" bindtap="navigateToExecution">
      <view class="nav-icon">âœ…</view>
      <view class="nav-label">æ‰§è¡Œè®°å½•</view>
    </view>
    <view class="nav-item {{currentPage === 'progress' ? 'active' : ''}}" bindtap="navigateToProgress">
      <view class="nav-icon">ğŸ“Š</view>
      <view class="nav-label">è¿›å±•åé¦ˆ</view>
    </view>
    <view class="nav-item {{currentPage === 'achievement' ? 'active' : ''}}" bindtap="navigateToAchievement">
      <view class="nav-icon">ğŸ†</view>
      <view class="nav-label">æˆå°±å±•å…</view>
    </view>
  </view>
</view>

<!-- æˆå°±è¯¦æƒ…å¼¹çª— -->
<view class="achievement-modal {{showModal ? 'show' : ''}}" bindtap="closeAchievementDetail">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-badge">
        <text class="modal-icon">{{selectedAchievement.icon}}</text>
      </view>
      <text class="modal-title">{{selectedAchievement.name}}</text>
      <view class="modal-rarity {{selectedAchievement.rarity}}">
        <text class="rarity-text">{{selectedAchievement.rarityText}}</text>
      </view>
    </view>
    <view class="modal-body">
      <text class="modal-description">{{selectedAchievement.description}}</text>
      <view class="modal-details">
        <view class="detail-item">
          <text class="detail-label">è·å¾—æ¡ä»¶</text>
          <text class="detail-value">{{selectedAchievement.condition}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å¥–åŠ±ç‚¹æ•°</text>
          <text class="detail-value">+{{selectedAchievement.points}} ç‚¹æ•°</text>
        </view>
        <view class="detail-item" wx:if="{{selectedAchievement.unlocked}}">
          <text class="detail-label">è§£é”æ—¶é—´</text>
          <text class="detail-value">{{selectedAchievement.unlockedDate}}</text>
        </view>
      </view>
    </view>
    <view class="modal-footer">
      <button class="modal-button secondary" bindtap="closeAchievementDetail">å…³é—­</button>
      <button class="modal-button" bindtap="copyAchievementInfo" wx:if="{{selectedAchievement.unlocked}}">å¤åˆ¶ä¿¡æ¯</button>
      <button class="modal-button primary" open-type="share" wx:if="{{selectedAchievement.unlocked}}">åˆ†äº«æˆå°±</button>
    </view>
  </view>
</view>