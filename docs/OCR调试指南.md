# OCR图像识别功能调试指南

## 问题现象
用户在使用图像识别功能时遇到 `读取图片文件失败` 错误。

## 已实施的解决方案

### 1. 修正模块引用路径
- **问题**: 文件名大小写不匹配
- **解决**: 将 `baiduOcr.js` 修正为 `baiduOCR.js`
- **文件**: `pages/theory/theory.js`, `utils/ocrTest.js`

### 2. 优化文件路径处理
- **问题**: 微信小程序临时文件路径格式复杂
- **解决**: 简化路径处理逻辑，直接使用chooseImage返回的路径
- **文件**: `utils/baiduOCR.js`

### 3. 添加权限配置
- **问题**: 缺少相机和相册访问权限
- **解决**: 在app.json中添加相关权限声明
- **文件**: `app.json`

### 4. 增强错误处理和调试
- **问题**: 错误信息不够详细
- **解决**: 添加文件信息检查和详细错误提示
- **文件**: `pages/theory/theory.js`, `utils/baiduOCR.js`

## 调试步骤

### 1. 检查控制台输出
在微信开发者工具中查看以下调试信息：
```
选择的图片路径: [路径]
完整的chooseImage返回结果: [结果对象]
文件信息: [文件大小、修改时间等]
开始读取图片文件: [路径]
文件读取成功，base64长度: [长度]
```

### 2. 常见错误类型

#### 文件路径错误
- **现象**: `not found` 错误
- **原因**: 临时文件路径格式不正确
- **解决**: 检查chooseImage返回的路径格式

#### 权限问题
- **现象**: `permission` 错误
- **原因**: 缺少文件系统访问权限
- **解决**: 确保app.json中配置了相关权限

#### 文件过大
- **现象**: `size` 错误
- **原因**: 图片文件超过8M限制
- **解决**: 使用compressed压缩选项

### 3. 测试建议

#### 使用开发模式测试
1. 在理论记录页面点击"测试OCR"按钮
2. 查看Access Token获取是否成功
3. 选择小尺寸图片进行测试

#### 图片选择建议
- 使用清晰的文字图片
- 文件大小控制在2M以内
- 支持格式：jpg、jpeg、png、bmp
- 图片尺寸：最短边≥15px，最长边≤4096px

## 技术规格

### API限制
- Base64编码后大小不超过8M
- 支持格式：jpg/jpeg/png/bmp
- 图片尺寸要求：15px ≤ 最短边，最长边 ≤ 4096px

### 网络配置
- 请求超时：60秒
- 需要访问百度AI开放平台域名
- 需要HTTPS协议支持

## 下一步优化

1. **添加图片预处理**
   - 自动压缩过大图片
   - 格式转换支持
   - 图片质量检查

2. **改进用户体验**
   - 添加进度指示器
   - 提供重试机制
   - 优化错误提示

3. **性能优化**
   - 实现Access Token缓存
   - 添加请求队列管理
   - 优化网络请求

## 联系支持
如果问题仍然存在，请提供：
1. 微信开发者工具控制台完整日志
2. 使用的图片信息（大小、格式、尺寸）
3. 具体的错误信息截图